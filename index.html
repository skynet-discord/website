<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Пустынная Долина</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0c0c1e 0%, #1a1a3e 50%, #2d1b4e 100%);
            color: #e6e6e6;
            font-family: 'Courier New', monospace;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Анимированный фон с снегом и тенями */
        .snow {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -2;
        }

        .shadow-figures {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.1;
        }

        .shadow {
            position: absolute;
            background: #000;
            border-radius: 50%;
            filter: blur(10px);
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: translateY(0) translateX(0); opacity: 0; }
            50% { opacity: 0.3; }
            100% { transform: translateY(-100px) translateX(100px); opacity: 0; }
        }

        .snowflake {
            position: absolute;
            color: #4a6572;
            font-size: 20px;
            animation: fall linear infinite;
            user-select: none;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border-bottom: 2px solid #6a457a;
            animation: glow 3s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from {
                text-shadow: 0 0 5px #fff, 0 0 10px #6a457a;
            }
            to {
                text-shadow: 0 0 10px #fff, 0 0 20px #6a457a, 0 0 30px #ff4444;
            }
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #ffffff;
        }

        .subtitle {
            font-size: 1.2em;
            color: #b8a0c8;
            font-style: italic;
        }

        .game-area {
            background: rgba(12, 12, 30, 0.9);
            border: 1px solid #6a457a;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 0 30px rgba(106, 69, 122, 0.4);
            min-height: 400px;
            backdrop-filter: blur(10px);
            position: relative;
        }

        .text-output {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 20px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .thought {
            color: #89c2d9;
            font-style: italic;
            margin: 10px 0;
            padding-left: 20px;
            border-left: 2px solid #89c2d9;
        }

        .warning {
            color: #ff6b6b;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .mystery {
            color: #d4a5e8;
            font-style: italic;
        }

        .choice {
            background: linear-gradient(135deg, rgba(106, 69, 122, 0.4), rgba(74, 101, 114, 0.3));
            border: 1px solid #6a457a;
            border-radius: 8px;
            padding: 15px;
            margin: 12px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .choice:hover {
            background: linear-gradient(135deg, rgba(106, 69, 122, 0.6), rgba(74, 101, 114, 0.5));
            border-color: #d4a5e8;
            transform: translateX(10px);
            box-shadow: 0 0 15px rgba(212, 165, 232, 0.5);
        }

        .choice::before {
            content: '⟩';
            position: absolute;
            left: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .choice:hover::before {
            opacity: 1;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding: 15px;
            background: rgba(106, 69, 122, 0.2);
            border-radius: 10px;
            border: 1px solid #6a457a;
        }

        .stat-item {
            text-align: center;
            position: relative;
        }

        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
        }

        .health { color: #ff6b6b; }
        .sanity { color: #89c2d9; }
        .warmth { color: #ffa726; }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .hidden-message {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid #ff6b6b;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .ending {
            text-align: center;
            padding: 30px;
            border: 2px solid #ff6b6b;
            border-radius: 10px;
            margin: 20px 0;
            animation: endingGlow 2s infinite alternate;
        }

        @keyframes endingGlow {
            from { box-shadow: 0 0 10px rgba(255, 107, 107, 0.5); }
            to { box-shadow: 0 0 30px rgba(255, 107, 107, 0.8); }
        }
    </style>
</head>
<body>
    <!-- Анимированный снег и тени -->
    <div class="snow" id="snow"></div>
    <div class="shadow-figures" id="shadowFigures"></div>

    <div class="container">
        <div class="header">
            <h1>ПУСТЫННАЯ ДОЛИНА</h1>
            <div class="subtitle">Твои выборы определяют твою судьбу... если она у тебя еще есть</div>
        </div>

        <div class="game-area">
            <div class="text-output" id="textOutput">
                <!-- Сюда будет выводиться текст игры -->
            </div>

            <div class="input-area" id="inputArea">
                <!-- Сюда будут добавляться варианты выбора -->
            </div>

            <div class="stats" id="stats">
                <!-- Статистика персонажа -->
            </div>
        </div>
    </div>

    <script>
        // Расширенное состояние игры
        const gameState = {
            hasJacket: false,
            isSick: false,
            hasCarKeys: false,
            hasFlashlight: false,
            hasWeapon: false,
            sawShadow: false,
            heardWhisper: false,
            foundNote: false,
            health: 100,
            sanity: 100,
            warmth: 100,
            endings: []
        };

        // Элементы DOM
        const textOutput = document.getElementById('textOutput');
        const inputArea = document.getElementById('inputArea');
        const statsElement = document.getElementById('stats');
        const snowContainer = document.getElementById('snow');
        const shadowContainer = document.getElementById('shadowFigures');

        // Создание теней
        function createShadows() {
            for (let i = 0; i < 8; i++) {
                const shadow = document.createElement('div');
                shadow.className = 'shadow';
                shadow.style.width = Math.random() * 100 + 50 + 'px';
                shadow.style.height = shadow.style.width;
                shadow.style.left = Math.random() * 100 + 'vw';
                shadow.style.top = Math.random() * 100 + 'vh';
                shadow.style.animationDelay = Math.random() * 20 + 's';
                shadow.style.animationDuration = (Math.random() * 30 + 30) + 's';
                shadowContainer.appendChild(shadow);
            }
        }

        // Создание снежинок
        function createSnowflakes() {
            for (let i = 0; i < 50; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.textContent = '❄';
                snowflake.style.left = Math.random() * 100 + 'vw';
                snowflake.style.animationDuration = (Math.random() * 5 + 5) + 's';
                snowflake.style.animationDelay = Math.random() * 5 + 's';
                snowflake.style.opacity = Math.random() * 0.5 + 0.3;
                snowContainer.appendChild(snowflake);
            }
        }

        // Функция для вывода текста с анимацией
        function printText(text, isThought = false, isWarning = false, isMystery = false) {
            return new Promise((resolve) => {
                const paragraph = document.createElement('div');

                if (isThought) {
                    paragraph.className = 'thought fade-in';
                } else if (isWarning) {
                    paragraph.className = 'warning fade-in';
                } else if (isMystery) {
                    paragraph.className = 'mystery fade-in';
                } else {
                    paragraph.className = 'fade-in';
                }

                textOutput.appendChild(paragraph);

                let index = 0;
                function typeWriter() {
                    if (index < text.length) {
                        paragraph.innerHTML += text.charAt(index);
                        index++;
                        setTimeout(typeWriter, isWarning ? 10 : 20);
                    } else {
                        textOutput.scrollTop = textOutput.scrollHeight;
                        resolve();
                    }
                }

                typeWriter();
            });
        }

        // Функция для создания кнопок выбора
        function createChoice(text, callback, isDangerous = false) {
            const choice = document.createElement('div');
            choice.className = 'choice fade-in';
            if (isDangerous) {
                choice.style.borderColor = '#ff6b6b';
            }
            choice.textContent = text;
            choice.onclick = () => {
                inputArea.innerHTML = '';
                callback();
            };
            inputArea.appendChild(choice);
        }

        // Функция для обновления статистики
        function updateStats() {
            statsElement.innerHTML = `
                <div class="stat-item">
                    <div>Здоровье</div>
                    <div class="stat-value health">${gameState.health}%</div>
                </div>
                <div class="stat-item">
                    <div>Рассудок</div>
                    <div class="stat-value sanity">${gameState.sanity}%</div>
                </div>
                <div class="stat-item">
                    <div>Тепло</div>
                    <div class="stat-value warmth">${gameState.warmth}%</div>
                </div>
            `;
        }

        // Случайные события
        function randomEvent() {
            const events = [
                async () => {
                    await printText("Вам показалось, что в окне соседнего дома мелькнула тень...", false, false, true);
                    gameState.sawShadow = true;
                    gameState.sanity -= 5;
                },
                async () => {
                    await printText("Ветер донес до вас странный шепот: 'Не ходи туда...'", false, false, true);
                    gameState.heardWhisper = true;
                    gameState.sanity -= 8;
                },
                async () => {
                    await printText("Вы заметили, что снег под вашими ногами странно хрустит, словно стекло...", false, false, true);
                }
            ];

            if (Math.random() < 0.4) { // 40% шанс случайного события
                const randomEvent = events[Math.floor(Math.random() * events.length)];
                randomEvent();
            }
        }

        // Начало игры
        async function startGame() {
            await printText("Вы просыпаетесь с тяжестью в голове. За окном - кромешная тьма, нарушаемая лишь бешеным танцем снежинок в свете фонарей.", false, false, true);
            await printText("Голова раскалывается... Что это было вчера? Кажется, я что-то важное забыл...", true);
            await printText("Надо поехать купить продуктов... если, конечно, магазины еще работают.", true);
            await printText("Подходя к окну, вы видите, что весь мир поглотила метель. Термометр за окном показывает -30°C.");

            createChoice("Надеть теплую куртку и перчатки", () => jacketChoice(true));
            createChoice("Остаться в домашней одежде - ведь я только до машины", () => jacketChoice(false));
            createChoice("Осмотреть квартиру - что-то тут не так...", () => investigateApartment());
        }

        // Расследование квартиры
        async function investigateApartment() {
            await printText("Вы решаете осмотреть квартиру. В прихожей лежит разбитая ваза...");
            await printText("На столе - недопитая чашка кофе. Он все еще теплый.");
            await printText("В спальне вы находите старую фотографию. На ней вы с кем-то, но лицо второго человека зачеркнуто.");
            await printText("Это начинает пугать...", true);
            gameState.sanity -= 10;

            await printText("В ящике тумбочки вы находите фонарик и складной нож.");

            createChoice("Взять фонарик", () => {
                gameState.hasFlashlight = true;
                printText("Вы взяли фонарик. Теперь в темноте будет не так страшно.").then(jacketScene);
            });
            createChoice("Взять нож", () => {
                gameState.hasWeapon = true;
                printText("Вы взяли нож. Лучше перестраховаться...").then(jacketScene);
            });
            createChoice("Оставить как есть и собираться", jacketScene);
        }

        async function jacketScene() {
            await printText("Пора выбираться отсюда. Что надеть?");
            createChoice("Надеть теплую куртку и перчатки", () => jacketChoice(true));
            createChoice("Остаться в домашней одежде", () => jacketChoice(false));
        }

        // Выбор с курткой
        async function jacketChoice(hasJacket) {
            gameState.hasJacket = hasJacket;

            if (hasJacket) {
                await printText("Вы надели старую дубленку. От нее пахнет нафталином и воспоминаниями.");
                gameState.warmth += 20;
            } else {
                await printText("Вы решаете, что до машины рукой подать.");
                await printText("Открывая дверь, вы понимаете, что холод здесь... другой. Он проникает прямо в душу.", false, true);
                gameState.warmth -= 15;
                gameState.sanity -= 5;
            }

            await carScene();
        }

        // Сцена у машины
        async function carScene() {
            randomEvent();

            await printText("Спускаясь по лестнице, вы замечаете, что все двери в подъезде открыты...");
            await printText("Как будто люди уходили в такой спешке, что даже не закрылись.");
            await printText("Подойдя к машине, вы понимаете, что ключей нет.");

            createChoice("Обыскать карманы еще раз", searchPockets);
            createChoice("Проверить, не в машине ли ключи", checkCar);
            createChoice("Просто пойти пешком - тут что-то нечисто", () => keysChoice(false));
        }

        async function searchPockets() {
            await printText("Вы тщательно обыскиваете карманы... и находите записку:");
            await printText("'ОНИ СЛЕДУЮТ ЗА ТЕНЯМИ. НЕ СМОТРИ В ОКНА. 23:17'", false, true);
            gameState.foundNote = true;
            gameState.sanity -= 15;

            createChoice("Вернуться за ключами", () => keysChoice(true));
            createChoice("Идти пешком - тут явно что-то не так", () => keysChoice(false));
        }

        async function checkCar() {
            await printText("Вы подходите к машине... и замечаете, что все стекла покрыты изнутри инеем.");
            await printText("Странно... Машина же должна быть теплее, чем на улице...", true);
            await printText("Вдруг из-под снега на лобовом стекле проявляется лицо!", false, true);
            gameState.sanity -= 20;

            createChoice("Отпрянуть назад", () => {
                printText("Вы отскакиваете от машины. Сердце бешено колотится.").then(() => keysChoice(false));
            });
            createChoice("Присмотреться ближе", () => {
                printText("Присмотревшись, вы понимаете - это ваше отражение... Или нет?", false, true)
                .then(() => {
                    gameState.sanity -= 10;
                    keysChoice(false);
                });
            });
        }

        // Выбор с ключами
        async function keysChoice(goBack) {
            if (goBack) {
                await printText("Вы бежите обратно в подъезд. Лестница кажется бесконечной...");
                await printText("Ключи на месте. Но пока вы их брали, вам показалось, что за спиной кто-то дышал.", false, true);
                gameState.hasCarKeys = true;
                gameState.sanity -= 10;

                await printText("Возвращаясь к машине, вы замечаете, что снег успел полностью замести ваш след.");
                await printText("Машина не заводится. Аккумулятор мертв, как и все вокруг.", false, true);
            }

            await printText("Придется идти пешком. Магазин в 15 минутах ходьбы... если он еще там.");

            if (!gameState.hasJacket) {
                await printText("Холод становится невыносимым. Кости ломит, пальцы немеют.", false, true);
                gameState.health -= 25;
                gameState.warmth -= 30;
            }

            await streetScene();
        }

        // Сцена на улице - несколько развилок
        async function streetScene() {
            randomEvent();

            await printText("Улица перед вами - белая пустыня. Ни движения, ни звуков.");
            await printText("Фонари мигают, отбрасывая причудливые тени.");

            createChoice("Идти прямо по главной дороге", mainRoad);
            createChoice("Срезать через парк - там может быть теплее", parkPath);
            createChoice("Заглянуть в соседний дом за помощью", neighborHouse);
        }

        async function mainRoad() {
            await printText("Идя по главной дороге, вы замечаете брошенные машины.");
            await printText("В одной из них сидит человек... неподвижный, покрытый инеем.", false, true);
            gameState.sanity -= 15;

            createChoice("Подойти ближе", investigateCar);
            createChoice("Ускорить шаг", hurryPast);
        }

        async function parkPath() {
            await printText("Парк встретил вас гробовой тишиной. Деревья стоят как замерзшие великаны.");
            await printText("Вдалеке мелькает огонек...");

            createChoice("Пойти на огонек", followLight);
            createChoice("Обойти парк стороной", avoidPark);
        }

        async function neighborHouse() {
            await printText("Дверь в соседний дом не заперта. Внутри - полный беспорядок.");
            await printText("На столе лежит дневник с последней записью:");
            await printText("'Они приходят с снегом. Не дай им увидеть тебя. Беги.'", false, true);
            gameState.sanity -= 20;

            createChoice("Взять дневник с собой", takeDiary);
            createChoice("Немедленно уйти", leaveHouse);
        }

        // Развилки сценария
        async function investigateCar() {
            await printText("Подойдя ближе, вы видите, что человек... не настоящий. Это манекен.");
            await printText("Но откуда на манекене иней изнутри машины?", true);
            gameState.sanity -= 10;
            finalScene();
        }

        async function followLight() {
            await printText("Огонек ведет вас вглубь парка. Вдруг он гаснет.");
            await printText("Вы остаетесь в полной темноте... и слышите шепот сзади: 'Ты опоздал...'", false, true);
            gameState.sanity -= 25;
            badEnding("Потерянный в темноте");
        }

        // Финальная сцена с несколькими концовками
        async function finalScene() {
            await printText("Наконец-то вы у магазина. Двери выломаны, внутри - хаос.");
            await printText("На полу валяются пустые упаковки, будто здесь был погром.");

            if (gameState.sanity < 30) {
                await printText("Голоса в голове становятся громче... Они говорят, что все это сон...", false, true);
                createChoice("Прислушаться к голосам", () => badEnding("Безумие"));
                createChoice("Попытаться взять себя в руки", investigateStore);
            } else {
                investigateStore();
            }
        }

        async function investigateStore() {
            await printText("В глубине магазина горит аварийный свет. Вы слышите странные звуки...");

            createChoice("Идти на звук", followSound);
            createChoice("Быстро собрать что можно и уходить", grabSupplies);
            createChoice("Проверить склад", checkStorage);
        }

        async function followSound() {
            await printText("Звук ведет вас в подсобку. Там вы находите рацию!");
            await printText("Из рации доносится голос: '...повторяем, эвакуационный пункт на стадионе...'");
            goodEnding("Спасение");
        }

        async function grabSupplies() {
            await printText("Вы хватаете консервы и выбегаете из магазина...");
            await printText("Но на улице вас ждет туман, из которого проступают силуэты...", false, true);
            mysteriousEnding("Исчезновение");
        }

        // Концовки
        function goodEnding(title) {
            const ending = document.createElement('div');
            ending.className = 'ending';
            ending.innerHTML = `
                <h2>КОНЦОВКА: ${title}</h2>
                <p>Вы добрались до стадиона, где организовали убежище для выживших.</p>
                <p>Теперь ваша задача - выжить и понять, что случилось с миром...</p>
                <p>Но впереди еще много зимних ночей...</p>
            `;
            textOutput.appendChild(ending);
            gameState.endings.push(title);
            showEndingStats();
        }

        function badEnding(title) {
            const ending = document.createElement('div');
            ending.className = 'ending';
            ending.innerHTML = `
                <h2>ПЛОХАЯ КОНЦОВКА: ${title}</h2>
                <p>Голоса в вашей голове победили. Вы стали частью тишины...</p>
                <p>Теперь вы один из них. Один из тех, кто следует за тенями.</p>
            `;
            textOutput.appendChild(ending);
            gameState.endings.push(title);
            showEndingStats();
        }

        function mysteriousEnding(title) {
            const ending = document.createElement('div');
            ending.className = 'ending';
            ending.innerHTML = `
                <h2>ТАИНСТВЕННАЯ КОНЦОВКА: ${title}</h2>
                <p>Силуэты в тумане приблизились... и вы поняли.</p>
                <p>Они не враги. Они - свидетели. Свидетели того, что должно произойти.</p>
                <p>Ваше путешествие только начинается...</p>
            `;
            textOutput.appendChild(ending);
            gameState.endings.push(title);
            showEndingStats();
        }

        function showEndingStats() {
            createChoice("Начать новую игру", () => location.reload());
        }

        // Запуск игры
        window.onload = function() {
            createSnowflakes();
            createShadows();
            startGame();
            updateStats();
        };
    </script>
</body>
</html>
